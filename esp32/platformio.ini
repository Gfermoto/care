[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; FreeRTOS Configuration
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DCONFIG_FREERTOS_HZ=1000
    -DCONFIG_FREERTOS_MAX_TASK_NAME_LEN=16
    -DCONFIG_FREERTOS_USE_STATS_FORMATTING_FUNCTIONS=1
    -DCONFIG_FREERTOS_USE_TRACE_FACILITY=1
    -DCONFIG_FREERTOS_VTASKLIST_INCLUDE_COREID=1

; High Performance Libraries
lib_deps = 
    RBEGamer/HLK-LD2450@^1.0.0
    adafruit/Adafruit MCP2515@^1.0.0
    WiFi
    ArduinoJson@^6.21.0
    AsyncTCP@^1.1.1
    ESPAsyncWebServer@^1.2.3
    LittleFS_esp32@^1.0.6
    ESP32Servo@^3.0.5

; Memory and Performance Optimization
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DCONFIG_FREERTOS_HZ=1000
    -DCONFIG_FREERTOS_MAX_TASK_NAME_LEN=16
    -DCONFIG_FREERTOS_USE_STATS_FORMATTING_FUNCTIONS=1
    -DCONFIG_FREERTOS_USE_TRACE_FACILITY=1
    -DCONFIG_FREERTOS_VTASKLIST_INCLUDE_COREID=1
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_240=1
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_MHZ=240
    -DCONFIG_SPIRAM_SUPPORT=1
    -DCONFIG_SPIRAM_USE_MALLOC=1
    -DCONFIG_SPIRAM_USE_CAPS_ALLOC=1
    -DCONFIG_SPIRAM_USE_MEMMAP=1
    -DCONFIG_SPIRAM_MEMTEST=1
    -DCONFIG_SPIRAM_BANKSWITCH_ENABLE=1
    -DCONFIG_SPIRAM_2T_MODE=1
    -DCONFIG_SPIRAM_SPEED_80M=1
    -DCONFIG_SPIRAM_IGNORE_NOTFOUND=1
    -DCONFIG_SPIRAM_WORKING_AREA_DRAM_OVERLAP=1
    -DCONFIG_SPIRAM_TRY_ALLOCATE_WIFI_LWIP=1
    -DCONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=0
    -DCONFIG_SPIRAM_TRY_ALLOCATE_WIFI_LWIP=1
    -DCONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=0
    -DCONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY=1
    -DCONFIG_SPIRAM_ALLOW_NOINIT_SEG_EXTERNAL_MEMORY=1
    -DCONFIG_SPIRAM_CACHE_WORKAROUND=1
    -DCONFIG_SPIRAM_BANKSWITCH_ENABLE=1
    -DCONFIG_SPIRAM_2T_MODE=1
    -DCONFIG_SPIRAM_SPEED_80M=1
    -DCONFIG_SPIRAM_IGNORE_NOTFOUND=1
    -DCONFIG_SPIRAM_WORKING_AREA_DRAM_OVERLAP=1
    -DCONFIG_SPIRAM_TRY_ALLOCATE_WIFI_LWIP=1
    -DCONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=0
    -DCONFIG_SPIRAM_TRY_ALLOCATE_WIFI_LWIP=1
    -DCONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=0
    -DCONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY=1
    -DCONFIG_SPIRAM_ALLOW_NOINIT_SEG_EXTERNAL_MEMORY=1
    -DCONFIG_SPIRAM_CACHE_WORKAROUND=1

; Upload settings
upload_port = /dev/ttyUSB0
upload_protocol = esptool

; Monitor settings
monitor_port = /dev/ttyUSB0
monitor_filters = 
    default
    time

; Board configuration for maximum performance
board_build.partitions = default.csv
board_build.filesystem = littlefs
board_build.flash_mode = dio
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_size = 4MB
board_build.arduino.memory_type = qio_opi
board_build.arduino.ldscript = esp32.rom.ld
board_build.arduino.ldscript = esp32.rom.spiram_incompatible_fns.ld

; Debug configuration
debug_tool = esp-builtin
debug_init_break = tbreak setup
debug_load_mode = manual