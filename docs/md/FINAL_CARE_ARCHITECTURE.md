# C.A.R.E. –§–∏–Ω–∞–ª—å–Ω–∞—è –°–∏—Å—Ç–µ–º–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üéØ **–ü–†–ò–ù–¶–ò–ü–´ –ê–†–•–ò–¢–ï–ö–¢–£–†–´**

### **üìä –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**

- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (ESP32/STM32)**: –¢–æ–ª—å–∫–æ —Å–±–æ—Ä –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö
- **ROS2 —Å–∏—Å—Ç–µ–º–∞**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

### **üöå CAN –ø—Ä–æ—Ç–æ–∫–æ–ª (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)**

```c
// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –¢–û–õ–¨–ö–û –¥–∞–Ω–Ω—ã–µ:
#define CAN_TARGET_DATA_BASE_ID 0x200  // 0x200, 0x201, 0x202 (—Ü–µ–ª–∏)
#define CAN_STATUS_ID           0x300  // –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

// Emergency –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏!
// –†–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç care_safety_controller_node
```

## üèóÔ∏è **–°–¢–†–£–ö–¢–£–†–ê ROS2 –ù–û–î–û–í**

### **1. care_common** üì¶

**–†–æ–ª—å**: –û–±—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã

```text
care_common/
‚îú‚îÄ‚îÄ msg/
‚îÇ   ‚îú‚îÄ‚îÄ RadarTarget.msg      # –ï–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ü–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ RadarTargets.msg     # –ú–∞—Å—Å–∏–≤ —Ü–µ–ª–µ–π  
‚îÇ   ‚îú‚îÄ‚îÄ SystemStatus.msg     # –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ SafetyCommand.msg    # –ö–æ–º–∞–Ω–¥—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ srv/
    ‚îú‚îÄ‚îÄ SetSafetyZone.srv    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–æ–Ω
    ‚îî‚îÄ‚îÄ ConfigController.srv # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
```

### **2. care_demo_node** üé≠  

**–†–æ–ª—å**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

```yaml
data_source: "mock"  # mock | can | uart

# Mock —Ä–µ–∂–∏–º
mock:
  realistic_ld2450_format: true
  scenario: "parking"  # parking | movement | obstacles

# CAN —Ä–µ–∂–∏–º  
can:
  interface: "can0"
  device_filters: [0x01, 0x02]  # –§–∏–ª—å—Ç—Ä –ø–æ device_id

# UART —Ä–µ–∂–∏–º
uart:
  port: "/dev/ttyUSB0" 
  mode: "sensor"       # sensor | controller
  # sensor = –ø—Ä—è–º–æ –∫ LD2450
  # controller = –∫ ESP32/STM32 –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### **3. care_can_interface_node** üöå

**–†–æ–ª—å**: –ß–∏—Å—Ç—ã–π CAN ‚Üî ROS2 –ø—Ä–æ—Ç–æ–∫–æ–ª

```cpp
// –ü—Ä–∏–Ω–∏–º–∞–µ—Ç CAN —Å–æ–æ–±—â–µ–Ω–∏—è:
// 0x200 + device_id*10 + target_id ‚Üí RadarTarget
// 0x300 + device_id*10 ‚Üí SystemStatus

// –ü—É–±–ª–∏–∫—É–µ—Ç ROS2 —Ç–æ–ø–∏–∫–∏:
// /care/device_{id}/targets
// /care/device_{id}/status
```

### **4. care_safety_controller_node** üõ°Ô∏è

**–†–æ–ª—å**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```cpp
// –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –í–°–ï –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–æ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
// –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è –æ–± emergency stop
// –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –û–ë–†–ê–¢–ù–û –≤ CAN:
// 0x100 ‚Üí Emergency Stop –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
```

## üìã **–ù–ê–°–¢–†–û–ô–ö–ò –ö–û–ù–¢–†–û–õ–õ–ï–†–û–í (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ)**

### **ESP32/STM32 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

```yaml
controller_config:
  device_id: 0x01           # ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö)
  can_bitrate: 500000       # –°–∫–æ—Ä–æ—Å—Ç—å CAN —à–∏–Ω—ã
  target_base_id: 0x200     # –ë–∞–∑–æ–≤—ã–π ID –¥–ª—è —Ü–µ–ª–µ–π
  status_id: 0x300          # ID —Å—Ç–∞—Ç—É—Å–∞
  # emergency_id: –£–î–ê–õ–ï–ù! –ù–µ –Ω—É–∂–µ–Ω –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
  
  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–¥–∞—Ä–∞ LD2450
  radar:
    uart_port: 2            # UART –Ω–æ–º–µ—Ä
    baud_rate: 256000       # –°–∫–æ—Ä–æ—Å—Ç—å
    max_targets: 3          # –ú–∞–∫—Å–∏–º—É–º —Ü–µ–ª–µ–π
```

### **CAN Message Format**

```c
// –¶–µ–ª—å (0x200 + device_id*10 + target_id):
// Device 1, Target 0: 0x200
// Device 1, Target 1: 0x201  
// Device 1, Target 2: 0x202
// Device 2, Target 0: 0x210
// Device 2, Target 1: 0x211
// Device 2, Target 2: 0x212

struct CanTargetMessage {
    int16_t x;          // Data[0-1]: X –≤ –º–º
    int16_t y;          // Data[2-3]: Y –≤ –º–º
    uint16_t distance;  // Data[4-5]: Distance –≤ –º–º
    int16_t speed;      // Data[6-7]: Speed –≤ —Å–º/—Å
} __attribute__((packed));

// –°—Ç–∞—Ç—É—Å (0x300 + device_id*10):
struct CanStatusMessage {
    uint8_t device_id;      // Data[0]: ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    uint8_t active_targets; // Data[1]: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–µ–ª–µ–π
    uint8_t system_status;  // Data[2]: 0=OK, 1=WARNING, 2=ERROR
    uint8_t reserved;       // Data[3]: –†–µ–∑–µ—Ä–≤
} __attribute__((packed));
```

## üîÑ **–ü–û–¢–û–ö –î–ê–ù–ù–´–•**

### **–ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º**

```text
LD2450 ‚Üí UART ‚Üí ESP32/STM32 ‚Üí CAN ‚Üí care_can_interface_node ‚Üí ROS2 Topics
                                                                    ‚Üì
                                                          care_demo_node (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
                                                                    ‚Üì
                                                       care_safety_controller_node
```

### **Emergency —Ä–µ–∂–∏–º**

```text
care_safety_controller_node –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ–ø–∞—Å–Ω–æ—Å—Ç—å
                    ‚Üì
            –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç CAN 0x100 (Emergency Stop)
                    ‚Üì
         ESP32/STM32 –ø–æ–ª—É—á–∞—é—Ç –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫—É
```

## üöÄ **LAUNCH –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò**

### **demo.launch.py** - –î–µ–º–æ —Ä–µ–∂–∏–º

```python
# –ó–∞–ø—É—Å–∫–∞–µ—Ç care_demo_node –≤ mock —Ä–µ–∂–∏–º–µ
# + RViz2 –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
# + Node.js dashboard
```

### **production_can.launch.py** - –ü—Ä–æ–¥–∞–∫—à–Ω —Å CAN

```python
# care_can_interface_node –¥–ª—è —á—Ç–µ–Ω–∏—è CAN
# care_safety_controller_node –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### **development_uart.launch.py** - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å UART

```python
# care_demo_node –≤ uart —Ä–µ–∂–∏–º–µ
# –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ LD2450 –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É
# –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

## ‚úÖ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ê–†–•–ò–¢–ï–ö–¢–£–†–´**

1. **üéØ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã = –¥–∞—Ç—á–∏–∫–∏, ROS2 = –º–æ–∑–≥–∏
2. **üîÑ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
3. **üõ°Ô∏è –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
4. **üîß –ì–∏–±–∫–æ—Å—Ç—å**: Mock/CAN/UART –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
5. **üìä –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ï–¥–∏–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π
6. **üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CAN –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

## üéØ **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò**

1. ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞
2. üîÑ –°–æ–∑–¥–∞—Ç—å care_common –ø–∞–∫–µ—Ç
3. üé≠ –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å care_demo_node  
4. üöå –°–æ–∑–¥–∞—Ç—å care_can_interface_node
5. üõ°Ô∏è –°–æ–∑–¥–∞—Ç—å care_safety_controller_node
6. üöÄ –°–æ–∑–¥–∞—Ç—å launch —Ñ–∞–π–ª—ã
7. üß™ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üèóÔ∏è
