# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ C.A.R.E. - CAN ‚Üî ROS Communication

## üéØ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã**

### **–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø**

- **ROS ‚Üî –ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**: –û–±—â–µ–Ω–∏–µ –ø–æ **CAN-—à–∏–Ω–µ**
- **WiFi**: –¢–æ–ª—å–∫–æ –¥–ª—è **–Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –∏ **–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**
- **UART**: –¢–æ–ª—å–∫–æ –¥–ª—è **LD2450 —Ä–∞–¥–∞—Ä–∞**

## üîÑ **–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö**

```text
LD2450 Radar ‚Üí UART ‚Üí –ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Üí CAN ‚Üí ROS2
                    ‚Üë
              WiFi (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
```

## üì° **CAN –ü—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è C.A.R.E.**

### **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã CAN —Å–æ–æ–±—â–µ–Ω–∏–π**

| CAN ID | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –î–∞–Ω–Ω—ã–µ | –ß–∞—Å—Ç–æ—Ç–∞ |
|--------|------------|--------|---------|
| `0x100` | **Emergency Stop** | `0x01` (–∞–∫—Ç–∏–≤–µ–Ω) | –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é |
| `0x200-0x202` | **Target 0-2** | X, Y, Distance, Speed | 20 Hz |
| `0x300` | **Status** | System status | 1 Hz |
| `0x400` | **Configuration** | Safety parameters | –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é |

### **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö Target**

```text
CAN ID: 0x200 + target_id (0-2)
DLC: 8 bytes
Data[0-1]: X coordinate (mm)
Data[2-3]: Y coordinate (mm) 
Data[4-5]: Distance (mm)
Data[6-7]: Speed (mm/s)
```

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º**

### **ESP32**

```text
LD2450 ‚Üí UART2 ‚Üí ESP32 ‚Üí TWAI (CAN) ‚Üí ROS2
                ‚Üë
            WiFi (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
```

### **Raspberry Pi Pico**

```text
LD2450 ‚Üí UART ‚Üí Pico ‚Üí SPI ‚Üí MCP2515 ‚Üí CAN ‚Üí ROS2
```

### **STM32F407**

```text
LD2450 ‚Üí UART2 ‚Üí STM32F407 ‚Üí CAN1 ‚Üí ROS2
```

## üîß **ROS2 CAN Bridge**

### **–§—É–Ω–∫—Ü–∏–∏ CAN-–º–æ—Å—Ç–∞**

1. **–ü—Ä–∏–µ–º CAN —Å–æ–æ–±—â–µ–Ω–∏–π** –æ—Ç –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
2. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è ROS2 —Ç–æ–ø–∏–∫–æ–≤**:
   - `/care/radar_targets` (RadarTargets.msg)
   - `/care/safety_status` (SafetyStatus.msg)
3. **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ ROS2 —Å–µ—Ä–≤–∏—Å—ã**:
   - `/care/set_safety_zone` (SetSafetyZone.srv)

### **CAN ‚Üí ROS2 Mapping**

```python
# CAN 0x200-0x202 ‚Üí /care/radar_targets
# CAN 0x100 ‚Üí /care/safety_status.emergency_stop
# CAN 0x300 ‚Üí /care/safety_status.system_status
```

## ‚öôÔ∏è **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

### **WiFi –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** (—Ç–æ–ª—å–∫–æ ESP32)

- **SSID**: `CARE_Radar_ESP32`
- **IP**: `192.168.4.1`
- **–ü–æ—Ä—Ç**: `80` (HTTP)
- **–§—É–Ω–∫—Ü–∏–∏**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### **CAN –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**

- **–°–∫–æ—Ä–æ—Å—Ç—å**: 500 kbps (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
- **–§–∏–ª—å—Ç—Ä—ã**: –ü—Ä–∏–µ–º –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Emergency Stop > Target Data > Status

## üö® **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

### **Emergency Stop –ª–æ–≥–∏–∫–∞**

1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ü–µ–ª–∏** –≤ –æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω–µ
2. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** CAN 0x100
3. **ROS2 –ø–æ–ª—É—á–∞–µ—Ç** —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CAN-–º–æ—Å—Ç
4. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è** —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–æ–±–æ—Ç–∞

### **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**

- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ**: < 50ms
- **CAN –ø–µ—Ä–µ–¥–∞—á–∞**: < 1ms  
- **ROS2 –æ–±—Ä–∞–±–æ—Ç–∫–∞**: < 10ms
- **–û–±—â–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: < 61ms

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ CAN**

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ –ø–µ—Ä–µ–¥–∞—á–∏
- –ó–∞–¥–µ—Ä–∂–∫–∏
- –°—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### **ROS2 —Ç–æ–ø–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**

- `/care/can_stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ CAN
- `/care/system_health` - –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã
- `/care/performance` - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üîÑ **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª**

### **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**

1. –ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CAN
3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ LD2450
4. ROS2 CAN-–º–æ—Å—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
5. –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö

### **–†–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º**

1. **20 Hz**: –ß—Ç–µ–Ω–∏–µ —Ä–∞–¥–∞—Ä–∞
2. **20 Hz**: –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ CAN
3. **50 Hz**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. **1 Hz**: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### **–ê–≤–∞—Ä–∏–π–Ω—ã–π —Ä–µ–∂–∏–º**

1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. Emergency Stop –ø–æ CAN
3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–±–æ—Ç–∞
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ CAN –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**

### ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**

- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

- –ù–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

### ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**

- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏
- –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª

## üõ†Ô∏è **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CAN**

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CAN —Ç—Ä–∞—Ñ–∏–∫–∞
candump can0

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
cansend can0 100#01
```

### **ROS2 –æ—Ç–ª–∞–¥–∫–∞**

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–ø–∏–∫–æ–≤
ros2 topic list
ros2 topic echo /care/radar_targets

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤
ros2 service list
ros2 service call /care/set_safety_zone
```

## üìã **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

**CAN-—à–∏–Ω–∞** - —ç—Ç–æ **–æ—Å–Ω–æ–≤–∞** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã C.A.R.E., –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è:

- –ù–∞–¥–µ–∂–Ω—É—é —Å–≤—è–∑—å —Å ROS2
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É
- –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

**WiFi** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, **–Ω–µ** –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.
