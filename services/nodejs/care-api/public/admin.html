<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C.A.R.E. Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #333;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .header p {
            font-size: 1.2rem;
            color: #aaa;
        }

        .tabs {
            display: flex;
            background: #2a2a2a;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            border-radius: 10px;
            margin: 5px;
        }

        .tab-button:hover {
            background: #333;
            color: #fff;
        }

        .tab-button.active {
            background: #4CAF50;
            color: white;
        }

        .tab-content {
            display: none;
            background: #2a2a2a;
            border-radius: 10px;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .config-section h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .config-group {
            background: #333;
            padding: 20px;
            border-radius: 8px;
        }

        .config-group label {
            display: block;
            margin-bottom: 8px;
            color: #4CAF50;
            font-weight: bold;
        }

        .config-group input,
        .config-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 5px;
            background: #444;
            color: #fff;
            font-size: 1rem;
        }

        .config-group input:focus,
        .config-group select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }

        .config-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #666;
            color: white;
        }

        .btn-secondary:hover {
            background: #777;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background: #e68900;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #2196F3;
            color: white;
        }

        .btn-info:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .status-section {
            background: #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-section h2 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }

        .status-label {
            font-weight: bold;
        }

        .status-value {
            color: #4CAF50;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background-color: #4CAF50; }
        .status-warning { background-color: #FF9800; }
        .status-danger { background-color: #F44336; }
        .status-offline { background-color: #666; }

        .endpoints-section {
            background: #333;
            border-radius: 10px;
            padding: 20px;
        }

        .endpoints-section h2 {
            color: #4CAF50;
            margin-bottom: 15px;
        }

        .endpoint-item {
            background: #444;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .endpoint-method {
            background: #4CAF50;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            margin-right: 15px;
            min-width: 80px;
            text-align: center;
        }

        .endpoint-path {
            flex-grow: 1;
            font-family: 'Consolas', 'Monaco', monospace;
            margin-right: 15px;
        }

        .endpoint-description {
            color: #ccc;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-connected {
            background: #4CAF50;
            color: white;
        }

        .connection-disconnected {
            background: #F44336;
            color: white;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        <span id="connectionText">Connecting...</span>
    </div>

    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è C.A.R.E. Admin Panel</h1>
            <p>Configuration & Control Center</p>
        </div>

        <div class="alert alert-success" id="successAlert">
            <strong>Success!</strong> <span id="successMessage"></span>
        </div>

        <div class="alert alert-error" id="errorAlert">
            <strong>Error!</strong> <span id="errorMessage"></span>
        </div>

        <div class="alert alert-warning" id="warningAlert">
            <strong>Warning!</strong> <span id="warningMessage"></span>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('status')">üìä Status</button>
            <button class="tab-button" onclick="showTab('radar-config')">üéØ Radar Config</button>
            <button class="tab-button" onclick="showTab('safety-config')">üõ°Ô∏è Safety Config</button>
            <button class="tab-button" onclick="showTab('controller-config')">üéÆ Controller Config</button>
            <button class="tab-button" onclick="showTab('api-endpoints')">üîå API Endpoints</button>
        </div>

        <!-- Status Tab -->
        <div id="status-tab" class="tab-content active">
            <div class="status-section">
                <h2>üìä Server Status</h2>
                <div class="status-item">
                    <span class="status-label">Status:</span>
                    <span id="apiStatus" class="status-value"><span class="status-indicator status-offline"></span>Loading...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Uptime:</span>
                    <span id="apiUptime" class="status-value">Loading...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Memory Usage:</span>
                    <span id="apiMemory" class="status-value">Loading...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Version:</span>
                    <span id="apiVersion" class="status-value">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Radar Configuration Tab -->
        <div id="radar-config-tab" class="tab-content">
            <div class="config-section">
                <h2>üéØ Radar Configuration</h2>
                <div class="config-grid">
                    <div class="config-group">
                        <label>Detection Range (mm):</label>
                        <input type="number" id="radarRange" value="5000" min="1000" max="20000">
                    </div>
                    <div class="config-group">
                        <label>Horizontal FOV (degrees):</label>
                        <input type="number" id="radarHFOV" value="120" min="60" max="180">
                    </div>
                    <div class="config-group">
                        <label>Vertical FOV (degrees):</label>
                        <input type="number" id="radarVFOV" value="30" min="10" max="90">
                    </div>
                    <div class="config-group">
                        <label>Update Frequency (Hz):</label>
                        <input type="number" id="radarFreq" value="10" min="1" max="100">
                    </div>
                    <div class="config-group">
                        <label>Target Count:</label>
                        <input type="number" id="targetCount" value="3" min="1" max="10">
                    </div>
                    <div class="config-group">
                        <label>Noise Level:</label>
                        <select id="noiseLevel">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="config-actions">
                    <button class="btn btn-primary" onclick="saveRadarConfig()">üíæ Save Radar Config</button>
                    <button class="btn btn-secondary" onclick="resetRadarConfig()">üîÑ Reset</button>
                    <button class="btn btn-danger" onclick="testRadarConfig()">üß™ Test</button>
                </div>
            </div>
        </div>

        <!-- Safety Configuration Tab -->
        <div id="safety-config-tab" class="tab-content">
            <div class="config-section">
                <h2>üõ°Ô∏è Safety Configuration</h2>
                <div class="config-grid">
                    <div class="config-group">
                        <label>Emergency Stop Distance (mm):</label>
                        <input type="number" id="emergencyDistance" value="500" min="100" max="2000">
                    </div>
                    <div class="config-group">
                        <label>Warning Distance (mm):</label>
                        <input type="number" id="warningDistance" value="1000" min="200" max="5000">
                    </div>
                    <div class="config-group">
                        <label>Safety Zone Angle (degrees):</label>
                        <input type="number" id="safetyAngle" value="120" min="60" max="180">
                    </div>
                    <div class="config-group">
                        <label>Auto Recovery:</label>
                        <select id="autoRecovery">
                            <option value="enabled" selected>Enabled</option>
                            <option value="disabled">Disabled</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label>Recovery Delay (seconds):</label>
                        <input type="number" id="recoveryDelay" value="5" min="1" max="60">
                    </div>
                    <div class="config-group">
                        <label>Safety Mode:</label>
                        <select id="safetyMode">
                            <option value="conservative">Conservative</option>
                            <option value="balanced" selected>Balanced</option>
                            <option value="aggressive">Aggressive</option>
                        </select>
                    </div>
                </div>
                <div class="config-actions">
                    <button class="btn btn-primary" onclick="saveSafetyConfig()">üíæ Save Safety Config</button>
                    <button class="btn btn-secondary" onclick="resetSafetyConfig()">üîÑ Reset</button>
                    <button class="btn btn-warning" onclick="triggerEmergencyStop()">üö® Test Emergency Stop</button>
                </div>
            </div>
        </div>

        <!-- Controller Configuration Tab -->
        <div id="controller-config-tab" class="tab-content">
            <div class="config-section">
                <h2>üéÆ Controller Configuration</h2>
                <div class="config-grid">
                    <div class="config-group">
                        <label>CAN Bitrate (bps):</label>
                        <select id="canBitrate">
                            <option value="125000">125 kbps</option>
                            <option value="250000">250 kbps</option>
                            <option value="500000" selected>500 kbps</option>
                            <option value="1000000">1 Mbps</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label>CAN Interface:</label>
                        <select id="canInterface">
                            <option value="mock">Mock (Testing)</option>
                            <option value="socketcan">SocketCAN (Real)</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label>Message Timeout (ms):</label>
                        <input type="number" id="messageTimeout" value="1000" min="100" max="10000">
                    </div>
                    <div class="config-group">
                        <label>Retry Count:</label>
                        <input type="number" id="retryCount" value="3" min="0" max="10">
                    </div>
                    <div class="config-group">
                        <label>Buffer Size:</label>
                        <input type="number" id="bufferSize" value="1000" min="100" max="10000">
                    </div>
                    <div class="config-group">
                        <label>Debug Mode:</label>
                        <select id="debugMode">
                            <option value="disabled" selected>Disabled</option>
                            <option value="enabled">Enabled</option>
                        </select>
                    </div>
                </div>
                <div class="config-actions">
                    <button class="btn btn-primary" onclick="saveControllerConfig()">üíæ Save Controller Config</button>
                    <button class="btn btn-secondary" onclick="resetControllerConfig()">üîÑ Reset</button>
                    <button class="btn btn-info" onclick="testControllerConnection()">üîó Test Connection</button>
                </div>
            </div>
        </div>

        <!-- API Endpoints Tab -->
        <div id="api-endpoints-tab" class="tab-content">
            <div class="endpoints-section">
                <h2>üîå API Endpoints</h2>
                <div id="apiEndpoints">
                    <!-- Endpoints will be loaded here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = window.location.origin;

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        // Alert management
        function showAlert(type, message) {
            const alert = document.getElementById(`${type}Alert`);
            const messageEl = document.getElementById(`${type}Message`);
            messageEl.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // API Status
        async function fetchApiStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                document.getElementById('apiStatus').innerHTML = `<span class="status-indicator status-online"></span>${data.status}`;
                document.getElementById('apiUptime').textContent = formatUptime(data.uptime);
                document.getElementById('apiVersion').textContent = data.version;
            } catch (error) {
                console.error('Error fetching API health:', error);
                document.getElementById('apiStatus').innerHTML = `<span class="status-indicator status-offline"></span>Error`;
                document.getElementById('apiUptime').textContent = 'N/A';
                document.getElementById('apiVersion').textContent = 'N/A';
            }
        }

        async function fetchApiStatistics() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/statistics`);
                const data = await response.json();
                const memoryUsage = data.data.system.memory_usage;
                document.getElementById('apiMemory').textContent =
                    `RSS: ${(memoryUsage.rss / 1024 / 1024).toFixed(2)} MB, ` +
                    `Heap: ${(memoryUsage.heapUsed / 1024 / 1024).toFixed(2)} MB`;
            } catch (error) {
                console.error('Error fetching API statistics:', error);
                document.getElementById('apiMemory').textContent = 'N/A';
            }
        }

        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            return `${hours}h ${minutes}m ${secs}s`;
        }

        // Configuration management
        async function saveRadarConfig() {
            const config = {
                range: parseInt(document.getElementById('radarRange').value),
                horizontalFOV: parseInt(document.getElementById('radarHFOV').value),
                verticalFOV: parseInt(document.getElementById('radarVFOV').value),
                frequency: parseInt(document.getElementById('radarFreq').value),
                targetCount: parseInt(document.getElementById('targetCount').value),
                noiseLevel: document.getElementById('noiseLevel').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/api/config/radar`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    showAlert('success', 'Radar configuration saved successfully!');
                } else {
                    showAlert('error', 'Failed to save radar configuration');
                }
            } catch (error) {
                showAlert('error', 'Error saving radar configuration: ' + error.message);
            }
        }

        async function saveSafetyConfig() {
            const config = {
                emergencyDistance: parseInt(document.getElementById('emergencyDistance').value),
                warningDistance: parseInt(document.getElementById('warningDistance').value),
                safetyAngle: parseInt(document.getElementById('safetyAngle').value),
                autoRecovery: document.getElementById('autoRecovery').value,
                recoveryDelay: parseInt(document.getElementById('recoveryDelay').value),
                safetyMode: document.getElementById('safetyMode').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/api/config/safety`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    showAlert('success', 'Safety configuration saved successfully!');
                } else {
                    showAlert('error', 'Failed to save safety configuration');
                }
            } catch (error) {
                showAlert('error', 'Error saving safety configuration: ' + error.message);
            }
        }

        async function saveControllerConfig() {
            const config = {
                canBitrate: parseInt(document.getElementById('canBitrate').value),
                canInterface: document.getElementById('canInterface').value,
                messageTimeout: parseInt(document.getElementById('messageTimeout').value),
                retryCount: parseInt(document.getElementById('retryCount').value),
                bufferSize: parseInt(document.getElementById('bufferSize').value),
                debugMode: document.getElementById('debugMode').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/api/config/controller`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    showAlert('success', 'Controller configuration saved successfully!');
                } else {
                    showAlert('error', 'Failed to save controller configuration');
                }
            } catch (error) {
                showAlert('error', 'Error saving controller configuration: ' + error.message);
            }
        }

        // Reset functions
        function resetRadarConfig() {
            document.getElementById('radarRange').value = 5000;
            document.getElementById('radarHFOV').value = 120;
            document.getElementById('radarVFOV').value = 30;
            document.getElementById('radarFreq').value = 10;
            document.getElementById('targetCount').value = 3;
            document.getElementById('noiseLevel').value = 'medium';
            showAlert('warning', 'Radar configuration reset to defaults');
        }

        function resetSafetyConfig() {
            document.getElementById('emergencyDistance').value = 500;
            document.getElementById('warningDistance').value = 1000;
            document.getElementById('safetyAngle').value = 120;
            document.getElementById('autoRecovery').value = 'enabled';
            document.getElementById('recoveryDelay').value = 5;
            document.getElementById('safetyMode').value = 'balanced';
            showAlert('warning', 'Safety configuration reset to defaults');
        }

        function resetControllerConfig() {
            document.getElementById('canBitrate').value = 500000;
            document.getElementById('canInterface').value = 'mock';
            document.getElementById('messageTimeout').value = 1000;
            document.getElementById('retryCount').value = 3;
            document.getElementById('bufferSize').value = 1000;
            document.getElementById('debugMode').value = 'disabled';
            showAlert('warning', 'Controller configuration reset to defaults');
        }

        // Test functions
        async function testRadarConfig() {
            showAlert('warning', 'Testing radar configuration...');
            // Simulate test
            setTimeout(() => {
                showAlert('success', 'Radar test completed successfully!');
            }, 2000);
        }

        async function triggerEmergencyStop() {
            showAlert('warning', 'Triggering emergency stop test...');
            // Simulate emergency stop
            setTimeout(() => {
                showAlert('success', 'Emergency stop test completed!');
            }, 3000);
        }

        async function testControllerConnection() {
            showAlert('warning', 'Testing controller connection...');
            // Simulate connection test
            setTimeout(() => {
                showAlert('success', 'Controller connection test successful!');
            }, 2000);
        }

        // API Endpoints
        function renderEndpoints() {
            const endpoints = [
                { method: 'GET', path: '/health', description: 'Health check —Å–µ—Ä–≤–∏—Å–∞' },
                { method: 'GET', path: '/api/radar/data', description: '–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–∞–¥–∞—Ä–∞' },
                { method: 'POST', path: '/api/radar/data', description: '–ó–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–∞–¥–∞—Ä–∞' },
                { method: 'GET', path: '/api/config/radar', description: '–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ä–∞–¥–∞—Ä–∞' },
                { method: 'POST', path: '/api/config/radar', description: '–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ä–∞–¥–∞—Ä–∞' },
                { method: 'GET', path: '/api/config/safety', description: '–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏' },
                { method: 'POST', path: '/api/config/safety', description: '–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏' },
                { method: 'GET', path: '/api/config/controller', description: '–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞' },
                { method: 'POST', path: '/api/config/controller', description: '–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞' },
                { method: 'GET', path: '/api/statistics', description: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã' }
            ];

            const endpointsContainer = document.getElementById('apiEndpoints');
            endpointsContainer.innerHTML = '';

            endpoints.forEach(endpoint => {
                const item = document.createElement('div');
                item.className = 'endpoint-item';
                item.innerHTML = `
                    <span class="endpoint-method">${endpoint.method}</span>
                    <span class="endpoint-path">${endpoint.path}</span>
                    <span class="endpoint-description">${endpoint.description}</span>
                `;
                endpointsContainer.appendChild(item);
            });
        }

        // Connection status
        function updateConnectionStatus() {
            const statusEl = document.getElementById('connectionStatus');
            const textEl = document.getElementById('connectionText');

            // Simulate connection check
            statusEl.className = 'connection-status connection-connected';
            textEl.textContent = 'Connected';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchApiStatus();
            fetchApiStatistics();
            renderEndpoints();
            updateConnectionStatus();

            // Update status every 5 seconds
            setInterval(() => {
                fetchApiStatus();
                fetchApiStatistics();
            }, 5000);
        });
    </script>
</body>
</html>
